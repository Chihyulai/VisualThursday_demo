<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <style type="text/css">
    .gmap{ display: block; width: 680px; height: 600px; }
    #range{ display: inline; width: 500px; }
  </style>
</head>
<body>

<div class="gmap" id="map-canvas"></div>
<p class="msg"></p>
<input id="range" type="range" list="data1" value="0" max="53000" min="0" name="range">
<span class="distance">0</span>M

<script src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="http://api.tiles.mapbox.com/mapbox.js/plugins/turf/v2.0.0/turf.min.js"></script>

<script>
var map, features;

function initialize() {
  $('#range').val(0);
  map = new google.maps.Map(document.getElementById('map-canvas'), {
    zoom: 13,
    mapTypeId: google.maps.MapTypeId.TERRAIN,
    center: new google.maps.LatLng(25.06126, 121.518168)
  });
}

d3.json("data/history.json", function(data) {
  // 轉成 GeoJson
  var line = turf.linestring( data.features[0].geometry.coordinates );

  // 計算路徑總長度
  d3.select('.msg').text('總長約 '+ turf.lineDistance(line, 'kilometers') +' 公里');

  initialize();
  var features = map.data.addGeoJson(line);

  $('#range').on("change", function(){
    var meter = this.value;
    document.querySelector(".distance").innerHTML = meter;
    var along = turf.along(line, meter / 1000, 'kilometers');

    var result = {
      "type": "FeatureCollection",
      "features": [line, along]
    };

    // 更新 map.data
    for (var i = 0; i < features.length; i++){ map.data.remove(features[i]); }
    features = map.data.addGeoJson(result);
  });

});

</script>